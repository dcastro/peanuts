<html>
<head>

    <title>Peanuts</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/deps/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/deps/highlightjs/styles/darkula.css">
    <link rel="stylesheet" href="/assets/styles/styles.css">
    
    <script src="/assets/scripts/codePrinter.js"></script>

    <script src="/deps/highlightjs/highlight.pack.min.js"></script>
    <script src="/deps/dat.gui/build/dat.gui.min.js"></script>
    <script src="/deps/stats-js/build/stats.min.js"></script>
    <script src="/deps/signals/dist/signals.min.js"></script>

    <script src="/deps/three/build/three.min.js"></script>
    <script src="/deps/three/examples/js/controls/OrbitControls.js"></script>

    <script src="/app/peanuts.js"></script>
    <script src="/app/peanuts.three.driver.js"></script>
    <script src="/app/peanuts.three.inputs.js"></script>
    <script src="/app/peanuts.three.app.js"></script>
    <script src="/app/peanuts.three.app.builder.js"></script>
    <script src="/app/peanuts.three.app.factory.js"></script>
    <script src="/app/peanuts.three.view.js"></script>
    <script src="/app/peanuts.three.view.builder.js"></script>
    <script src="/app/peanuts.three.math.helpers.js"></script>
    <script src="/app/ui/peanuts.three.dat.gui.lights.js"></script>
    <script src="/app/ui/peanuts.three.dat.gui.materials.js"></script>

    <style type="text/css">
        .threeApp {
            height: 600px;
        }
    </style>

</head>

<body class="page">

<div class="container">

    <h1>Basic Materials</h1>

    <h2>Mesh Phong Material</h2>

    <div id="appMeshPhongMaterial" class="threeApp"></div>

    <script type="text/javascript">

        (CodePrinter.printAndRun(function() {

            var app = new Peanuts.Three.App.Factory(
                document.getElementById("appMeshPhongMaterial")
            ).createDemoGLPerspectiveApp();


            function createScene(lightSettings, materialSettings) {

                var lightAmbient = new THREE.AmbientLight(0x404040);

                var lightDirectional = new THREE.DirectionalLight(
                    lightSettings.color, 
                    lightSettings.intensity
                );

                lightDirectional.position.setFromSpherical(
                    new THREE.Spherical(
                        lightSettings.distance,
                        lightSettings.phi,
                        lightSettings.theta
                    )
                );

                var lightDirectionalHelper = new THREE.DirectionalLightHelper(lightDirectional, 2);

                var material = new THREE.MeshPhongMaterial({
                    color: new THREE.Color(materialSettings.color),
                    wireframe: materialSettings.wireframe,
                    opacity: materialSettings.opacity
                });

                app.loader.texture.load(
                    materialSettings.map,
                    function (texture) {
                        material.map = texture;
                        material.needsUpdate = true;
                    }
                );

                app.loader.texture.load(
                    materialSettings.specularMap,
                    function (texture) {
                        material.specularMap = texture;
                        material.needsUpdate = true;
                    }
                );

                app.loader.texture.load(
                    materialSettings.normalMap,
                    function (texture) {
                        material.normalMap = texture;
                        material.needsUpdate = true;
                    }
                );

                var geometry = new THREE.BoxGeometry(2, 2, 2);
                    geometry.computeVertexNormals();
                    geometry.computeFaceNormals();

                var mesh = new THREE.Mesh(geometry, material);

                app.view.scene = new THREE.Scene();

                app.view.scene.add(lightAmbient);
                app.view.scene.add(lightDirectional);
                app.view.scene.add(lightDirectionalHelper);

                app.view.scene.add(mesh);
            }


            function initaliseUI() {

                var settings = {
                    material: { 
                        map: "textures/metal/mtl_O_c.png",
                        specularMap: "textures/metal/mtl_O_s.png",
                        normalMap: "textures/metal/mtl_O_n.png"  
                    },
                    light: {}
                };

                Peanuts.Three.DatGui.Helpers.Materials.MeshPhong.add(
                    app.datGui.addFolder("PhongMaterial"), 
                    settings.material, {
                        map: [
                            "None",
                            "textures/metal/mtl_O_c.png",
                            "textures/metal/mtl_wall01_c.png",
                            "textures/metal/mtl_floor01_c.png",
                            "textures/metal/mtl_floor02_c.png",
                            "textures/metal/mtl_floor03_c.png"
                        ],
                        specularMap: [
                            "None",
                            "textures/metal/mtl_O_s.png",
                            "textures/metal/mtl_wall01_s.png",
                            "textures/metal/mtl_floor01_s.png",
                            "textures/metal/mtl_floor02_s.png",
                            "textures/metal/mtl_floor03_s.png"
                        ],
                        normalMap : [
                            "textures/metal/mtl_O_n.png",
                            "textures/metal/mtl_wall01_n.png",
                            "textures/metal/mtl_floor01_n.png",
                            "textures/metal/mtl_floor02_n.png",
                            "textures/metal/mtl_floor03_n.png"  
                        ]
                    },
                    function(materialSettings) {
                        settings.material = materialSettings;
                        createScene(
                            settings.light, 
                            settings.material
                        );
                    }
                );

                Peanuts.Three.DatGui.Helpers.Lights.Directional.add(
                    app.datGui.addFolder("DirectionalLight"), 
                    settings.light, {},  
                    function(lightSettings) {
                        settings.light = lightSettings;    
                        createScene(
                            settings.light, 
                            settings.material
                        );
                    }
                );

            }

            initaliseUI();

            app.start();

        }))();

    </script>

</div>

</body>

</html>