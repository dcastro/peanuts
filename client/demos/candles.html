<html>
<head>

    <title>Peanuts</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/deps/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="/deps/highlightjs/styles/darkula.css">
    <link rel="stylesheet" href="/assets/styles/styles.css">
    
    <script src="/assets/scripts/codePrinter.js"></script>
    <script src="/assets/scripts/gdax/candles.js"></script>

    <script src="/deps/highlightjs/highlight.pack.min.js"></script>
    <script src="/deps/dat.gui/build/dat.gui.min.js"></script>
    <script src="/deps/stats-js/build/stats.min.js"></script>
    <script src="/deps/signals/dist/signals.min.js"></script>

    <script src="/deps/three/build/three.min.js"></script>
    <script src="/deps/three/examples/js/controls/OrbitControls.js"></script>

    <script src="/app/peanuts.js"></script>
    <script src="/app/peanuts.three.driver.js"></script>
    <script src="/app/peanuts.three.inputs.js"></script>
    <script src="/app/peanuts.three.app.js"></script>
    <script src="/app/peanuts.three.app.builder.js"></script>
    <script src="/app/peanuts.three.app.factory.js"></script>
    <script src="/app/peanuts.three.view.js"></script>
    <script src="/app/peanuts.three.view.builder.js"></script>
    <script src="/app/ui/peanuts.three.dat.gui.js"></script>
    <script src="/app/ui/peanuts.three.dat.gui.geometry.js"></script>

    <style type="text/css">
        .threeApp {
            height: 640px;
        }
    </style>

</head>

    <body class="page">

        <div class="container">

            <h1>Simple Candle Chart</h1>

            <h2>Sphere Geometry</h2>

            <div id="app" class="threeApp"></div>

            <script type="text/javascript">

                (CodePrinter.printAndRun(function() {

                    var app = new Peanuts.Three.App.Factory(
                        document.getElementById("app")
                    ).createDemoGLPerspectiveApp();


                    var demoSettings  = {
                        chartHeight : 100
                    };

                    function ChartFactory(chartSettings) {
                        this.chartSettings = chartSettings;
                    }

                    ChartFactory.create = function (candleData) {

                        var createCandle = function (open, close, high, low, volume) {
                            return new THREE.Mesh(
                                new THREE.BoxGeometry(
                                    10,                         //width
                                    (open - close),             //height
                                    10,                         //depth
                                    1,                          //width segments
                                    1,                          //height sehments
                                    1                           //depth segments
                                ), 
                                new THREE.MeshBasicMaterial({
                                    wireframe: true,
                                    color: 0x00ff00
                                })
                            );
                        };

                        var maxPrice = candleData.reduce(
                                        function (acc, value, i) {
                                            console.log('reducting',value);
                                            return Math.max(acc,value[2]);
                                       });

                        return candleFactory.createCandle(10,10,10,10,10);
                    }

                    function createScene(candleData) {

                        var ambientLight = new THREE.AmbientLight(0x444444);

                        var chartFactory = new ChartFactory();

                        var chart = chartFactory.create(candleData);

                        app.view.camera.position.set(0,0, -50);

                        app.view.setScene(new THREE.Scene());
                        app.view.scene.add(app.view.camera);
                        app.view.scene.add(ambientLight);
                        app.view.scene.add(chart);
                    }

                    var candleFetcher = new Candles();

                    candleFetcher.fetch("ETH-USD", 60*60, "2018-07-01","2018-07-12", 
                        function(candleData) {
                            createScene(
                                demoSettings, 
                                candleData
                            );
                        }
                    );

                    app.start();

                }))();

            </script>
        </div>
    </body>
</html>